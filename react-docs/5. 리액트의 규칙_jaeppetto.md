### ğŸ“š Reactì—ì„œ ê°•ì¡°í•˜ëŠ” í•µì‹¬

1. ìˆœìˆ˜ì„± : ì»´í¬ë„ŒíŠ¸ì™€ í›…ì€ **ì˜¤ì§ ê³„ì‚°ë§Œ ìˆ˜í–‰**í•´ì•¼ í•œë‹¤.
2. ë©±ë“±ì„± : ê°™ì€ ì…ë ¥(Props, State, Context)ì— ëŒ€í•´ **í•­ìƒ ê°™ì€ ì¶œë ¥ì„ ë³´ì¥**í•´ì•¼ í•œë‹¤.
3. ë Œë”ë§ ì¤‘ì—ëŠ” ì‚¬ì´ë“œ ì´í™íŠ¸ë¥¼ ì‹¤í–‰í•˜ì§€ ì•Šê³ , ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë‚˜ Effectsë¡œ ê²©ë¦¬í•´ì•¼ í•œë‹¤.
   1. ì¼ë°˜ì ìœ¼ë¡œ ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ë¥¼ í†µí•´ íŠ¸ë¦¬ê±° ì‹œì ì„ ì œì–´í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ê³ , ë¶ˆê°€í”¼í•œ ê²½ìš° Effectsë¥¼ ì‚¬ìš©í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•˜ê³  ìˆë‹¤.
4. ë¶ˆë³€ì„± : ì¸ìˆ˜ì™€ ë°˜í™˜ê°’ì€ ëª¨ë‘ ë¶ˆë³€ìœ¼ë¡œ ì·¨ê¸‰í•œë‹¤.
5. ì§€ì—­ ë³€ê²½(Local Mutation)ì€ í—ˆìš©í•˜ê³  ìˆë‹¤.
   1. ì˜¤íˆë ¤ ì„±ëŠ¥ ìµœì í™”ì— ìœ ìš©í•˜ë‹¤ê³  ì´ë¥¼ ê¶Œì¥í•˜ê³  ìˆë‹¤.
   2. ì§€ì—­ ë³€ê²½ì€ ë¦¬ì•¡íŠ¸ì˜ ë¦¬ë Œë”ë§ì´ ë°œìƒí•  ë•Œë§ˆë‹¤ ê°™ì´ ì´ˆê¸°í™”ë˜ì–´ì„œ ì‚¬ì´ë“œ ì´í™íŠ¸ë¥¼ ìœ ë°œí•˜ì§€ ì•Šê¸° ë•Œë¬¸ì´ë¼ê³  í•œë‹¤.
6. ê²°êµ­ ë¦¬ì•¡íŠ¸ì—ì„œ ê°•ì¡°í•˜ëŠ” í•µì‹¬ê³¼ ê·œì¹™ì„ ì¤€ìˆ˜í•´ì•¼ í•˜ëŠ” ì´ìœ ëŠ”Â **ë¦¬ì•¡íŠ¸ì˜ ìì²´ì ì¸ ìµœì í™” ë¡œì§ì— ë¶€í•˜ë¥¼ ì¼ìœ¼í‚¬ë§Œí•œ í–‰ìœ„ë¥¼ í•˜ì§€ ì•Šê¸° ìœ„í•¨**ì´ë¼ëŠ” ìƒê°ì´ ë“ ë‹¤.Â ~~ì½”ë”©ì€ ë¶€ì±„ë‹¤!~~

<br />

### ğŸ“š Hooksë¥¼ ì¡°ê±´ë¶€ë¡œ í˜¸ì¶œí•˜ë©´ ì•ˆë˜ëŠ” ì´ìœ 

ë¦¬ì•¡íŠ¸ëŠ” í›…ì˜ í˜¸ì¶œ ìˆœì„œë¥¼ ê¸°ì–µí•˜ê³  ìˆëŠ”ë°, ì¡°ê±´ë¶€ë¡œ í˜¸ì¶œí•˜ê²Œ ë˜ë©´ ë©±ë“±ì„±ì´ ê¹¨ì§€ê²Œ ëœë‹¤. ë¦¬ì•¡íŠ¸ì—ì„œëŠ” í›…ì„ ì–´ë–»ê²Œ ìˆœì°¨ì ìœ¼ë¡œ ì²˜ë¦¬í•˜ê³  ìˆì„ê¹Œ? (ê°œë°œí•˜ë©´ì„œ í›… í˜¸ì¶œ ì´ë ¥ì„ ë¹„êµí•˜ì—¬ ë‹¤ë¥¸ ë¶€ë¶„ì„ ì•Œë ¤ì£¼ëŠ” ì—ëŸ¬ ë¡œê·¸ë¥¼ ë³¸ ì ì´ ìˆì„ ê²ƒì´ë‹¤.)

(ì‘ì„± ì¤‘..)

<br />

### ğŸ“šÂ ë¦¬ì•¡íŠ¸ ë‚´ì¥ í›…ë“¤ ì¤‘ ë Œë”ë§ ê³¼ì • ì¤‘ì— í˜¸ì¶œë˜ëŠ” í›…ê³¼ ë Œë”ë§ ì´í›„ í˜¸ì¶œë˜ëŠ” í›…

ë¦¬ì•¡íŠ¸ëŠ” UIì˜ ë‹¤ìŒ ë²„ì „ì´ ì–´ë–»ê²Œ ë³´ì¼ì§€ ê³„ì‚°í•˜ëŠ” ë Œë”ë§ ê³¼ì •(Render Phase), ìµœì‹  ë²„ì „ê³¼ ì¼ì¹˜ì‹œí‚¤ê¸° ìœ„í•´ DOMì— í•„ìš”í•œ ìµœì†Œí•œì˜ ë³€ê²½ì„ ì²˜ë¦¬í•˜ëŠ” ì»¤ë°‹ ê³¼ì •(Commit Phase)ì˜ ë‹¨ê³„ë¡œ [ì½”ë“œë¥¼ ì‹¤í–‰](https://ko.react.dev/reference/rules/components-and-hooks-must-be-pure#how-does-react-run-your-code)ì‹œí‚¨ë‹¤ê³  í•œë‹¤.

```mermaid
graph TD
    A[Component ë Œë”ë§] --> B[beginWork]
    B --> C[updateFunctionComponent]
    C --> D[renderWithHooks]
    D --> E{Hook íƒ€ì…}

    E -->|ìƒíƒœ ê´€ë¦¬| F[useState, useMemo, useCallback<br/>ì¦‰ì‹œ ì‹¤í–‰]
    E -->|Effect| G[useEffect, useLayoutEffect<br/>ë“±ë¡ë§Œ]

    F --> H[Render Phase ì™„ë£Œ]
    G --> H

    H --> I[commitRootImpl]
    I --> J[commitLayoutEffects]
    I --> K[scheduleCallback]

    J --> L[useLayoutEffect ë™ê¸° ì‹¤í–‰]
    K --> M[flushPassiveEffects]
    M --> N[useEffect ë¹„ë™ê¸° ì‹¤í–‰]
```

**Render Phase** (ì»´í¬ë„ŒíŠ¸ì˜ ìƒíƒœ ê³„ì‚°ê³¼ ë©”ëª¨ì´ì œì´ì…˜ ì²˜ë¦¬)

1. ìƒíƒœê´€ë¦¬ : `useState`, `useReducer`, `useContext`
2. ìµœì í™” : `useMemo`, `useCallback`
3. ì°¸ì¡° : `useRef` (ref.current í• ë‹¹ì€ Commit Phaseì—ì„œ ì´ë£¨ì–´ì§„ë‹¤ê³  í•¨)
4. ğŸ¤”Â Commit Phaseì—ì„œ ì‹¤ì œ DOMì„ ì—…ë°ì´íŠ¸í•˜ë ¤ë©´, í•´ë‹¹ ì‹œì ì— Virtual DOMì´ ìƒì„±ë˜ë ¤ë‚˜?

<br />

ì˜ˆë¥¼ ë“¤ì–´ useStateì˜ ê²½ìš° `renderWithHooks` í•¨ìˆ˜ì—ì„œ ë§ˆìš´íŠ¸ / ì—…ë°ì´íŠ¸ ìƒíƒœì— ë”°ë¼ mountState / updateStateë¡œ ë°”ì¸ë”©ëœ `HooksDispatcher`ë¥¼ í˜¸ì¶œí•œë‹¤.

https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberHooks.js

```tsx
const HooksDispatcherOnMount: Dispatcher = {
  readContext,
  use,
  useCallback: mountCallback,
  useContext: readContext,
  useEffect: mountEffect,
  useImperativeHandle: mountImperativeHandle,
  useLayoutEffect: mountLayoutEffect,
  useInsertionEffect: mountInsertionEffect,
  useMemo: mountMemo,
  useReducer: mountReducer,
  useRef: mountRef,
  useState: mountState,
  useDebugValue: mountDebugValue,
  useDeferredValue: mountDeferredValue,
  useTransition: mountTransition,
  useSyncExternalStore: mountSyncExternalStore,
  useId: mountId,
  useHostTransitionStatus: useHostTransitionStatus,
  useFormState: mountActionState,
  useActionState: mountActionState,
  useOptimistic: mountOptimistic,
  useMemoCache,
  useCacheRefresh: mountRefresh,
};
```

```tsx
function mountState<S>(
  initialState: (() => S) | S,
): [S, Dispatch<BasicStateAction<S>>] {
  const hook = mountStateImpl(initialState);
  const queue = hook.queue;
  const dispatch: Dispatch<BasicStateAction<S>> = (dispatchSetState.bind(
    null,
    currentlyRenderingFiber,
    queue,
  ): any);
  queue.dispatch = dispatch;
  return [hook.memoizedState, dispatch];
}
```

Effect ê´€ë ¨ í›…ë“¤ë„ HooksDispatcherì—ì„œ ê°™ì´ ë°”ì¸ë”©ë˜ì§€ë§Œ, ë Œë”ë§ ë‹¨ê³„ì—ì„œëŠ” `pushSimpleEffect`ì™€ í”Œë˜ê·¸ë¥¼ ë„˜ê²¨ **ë“±ë¡**ë§Œ ì§„í–‰í•˜ê³  ì»¤ë°‹ ë‹¨ê³„ì˜ `commitPassiveMountEffects` í•¨ìˆ˜ ë‚´ë¶€ `commitHookEffectListMount`ì—ì„œ í˜¸ì¶œë˜ëŠ” ê²ƒì„ í™•ì¸í•˜ì˜€ë‹¤. ([ReactFiberCommitWork.js](https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberCommitWork.js)**)**

<br />

**Commit Phase** (DOM ì¡°ì‘ê³¼ Effect ì²˜ë¦¬)

1. `useInsertionEffect` : DOM ë³€ê²½ ì „ ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ë©°, CSS-in-JS ë¼ì´ë¸ŒëŸ¬ë¦¬ì— ë™ì  ìŠ¤íƒ€ì¼ì„ ì£¼ì… ìœ„í•´ ì‚¬ìš© â†’ [í•´ë‹¹ ëª©ì ì´ ì•„ë‹ˆë¼ë©´ `useEffect` ë˜ëŠ” `useLayoutEffect` ì‚¬ìš©ì„ ê¶Œì¥](https://ko.react.dev/reference/react/useInsertionEffect)í•˜ê³  ìˆìŒ
2. DOM ì—…ë°ì´íŠ¸ ë‹¨ê³„
3. `useLayoutEffect` : ë¸Œë¼ìš°ì € Paint ë‹¨ê³„ ì´ì „ì— Layout ì •ë³´ë¥¼ ì½ì–´ì™€ ì¶”ê°€ DOMì„ ì¡°ì‘í•  ìˆ˜ ìˆã…‡ë¯€ (ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰ë˜ì–´ Paint ë‹¨ê³„ë¥¼ ì°¨ë‹¨í•˜ê³ , Layoutì„ ì¬ê³„ì‚°)
4. ë¸Œë¼ìš°ì € Paint ë‹¨ê³„
5. `useEffect` : ë¸Œë¼ìš°ì € Paint ë‹¨ê³„ ì´í›„ (ë¹„ë™ê¸°ì ìœ¼ë¡œ ì‹¤í–‰)
6. ğŸ¤”Â ref.current í• ë‹¹ì€ ì´ ì¤‘ ì–´ëŠ ë‹¨ê³„ì—ì„œ ì²˜ë¦¬ë˜ëŠ”ê°€?
   - DOM ë³€ê²½ í›„ - ë¸Œë¼ìš°ì € Paint ì „ ì‚¬ì´ì— ì²˜ë¦¬ëœë‹¤ê³ ëŠ” í•˜ëŠ”ë°, ì¶”ì í•˜ê¸° ì‰½ì§€ ì•ŠìŒ..

<br />

ë¦¬ì•¡íŠ¸ ë‚´ë¶€ì—ì„œ ì‹¤í–‰ ë‹¨ê³„ë³„ë¡œ ì–´ë–¤ í›…ì„ ì²˜ë¦¬í•˜ëŠ”ì§€ ì‚´í´ë´„ìœ¼ë¡œì¨ â€˜ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ìˆëŠ” ì½”ë“œ(ì „ì—­ ë³€ìˆ˜ ê°’ ìˆ˜ì • ë“±)ëŠ” ì´ë²¤íŠ¸ í•¸ë“¤ëŸ¬ ë˜ëŠ” Effectë¥¼ ì´ìš©í•´ ì²˜ë¦¬í•˜ë¼â€™ë¼ê³  í•˜ëŠ” ì´ìœ (EffectëŠ” Commit Phaseì—ì„œ ì²˜ë¦¬ë˜ê¸° ë•Œë¬¸ì—!)ë¥¼ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

ì»´í¬ë„ŒíŠ¸ì— ì¶”ì ë˜ì§€ ì•Šì€ ì‚¬ì´ë“œ ì´í™íŠ¸ê°€ ìˆëŠ” ê²½ìš° ë¦¬ì•¡íŠ¸ê°€ ë Œë”ë§ ì½”ë“œë¥¼ ë‹¤ì‹œ ì‹¤í–‰í•  ë•Œ ì›í•˜ì§€ ì•ŠëŠ” ë°©ì‹ìœ¼ë¡œ íŠ¸ë¦¬ê±°ë  ìˆ˜ ìˆê³ , ì´ëŠ” ì¢…ì¢… ì˜ˆìƒì¹˜ ëª»í•œ ë²„ê·¸ë¡œ ì´ì–´ì ¸ ì‚¬ìš©ìì˜ ì•± ê²½í—˜ì„ ì €í•˜í•  ìˆ˜ ìˆê²Œ ë˜ëŠ” ê²ƒì´ë‹¤.

<br />

### ğŸ“š State ë˜ëŠ” Propsë¥¼ ì§ì ‘ ë³€ê²½í•˜ëŠ” ê²ƒê³¼ Setterë¥¼ ì‚¬ìš©í•´ ë³€ê²½í•˜ëŠ” ê²ƒì˜ ë¦¬ì•¡íŠ¸ ë‚´ë¶€ ë™ì‘ ì°¨ì´

ì „ë‹¬ë°›ì€ Propsë‚˜ ì„ ì–¸í•œ Stateë¥¼ ì§ì ‘ ì°¸ì¡°í•´ ë³€ê²½í•´ë„ ê°’ì€ ë³€í•˜ì§€ë§Œ, ë Œë”ë§ì€ íŠ¸ë¦¬ê±°ë˜ì§€ ì•ŠëŠ”ë‹¤ëŠ” ê²ƒì€ ì•Œê³  ìˆë‹¤. ë¦¬ì•¡íŠ¸ì˜ SetterëŠ” ë‚´ë¶€ì—ì„œ ì–´ë–»ê²Œ ë™ì‘í•˜ê³ , ì™œ ì§ì ‘ ê°’ì„ ë³€ê²½í•˜ë©´ ì•ˆë˜ëŠ” ê±¸ê¹Œ?

[react-reconciler/src/ReactFiberHooks.js](https://github.com/facebook/react/blob/main/packages/react-reconciler/src/ReactFiberHooks.js)

```tsx
react/packages/react-reconciler/src/ReactFiberHooks.js

const currentState: S = (queue.lastRenderedState: any);
const eagerState = lastRenderedReducer(currentState, action);
// Stash the eagerly computed state, and the reducer used to compute
// it, on the update object. If the reducer hasn't changed by the
// time we enter the render phase, then the eager state can be used
// without calling the reducer again.
update.hasEagerState = true;
update.eagerState = eagerState;

if (is(eagerState, currentState)) {
  // Fast path. We can bail out without scheduling React to re-render.
  // It's still possible that we'll need to rebase this update later,
  // if the component re-renders for a different reason and by that
  // time the reducer has changed.
  // TODO: Do we still need to entangle transitions in this case?
  enqueueConcurrentHookUpdateAndEagerlyBailout(fiber, queue, update);
  return false;
}
```

ì»´í¬ë„ŒíŠ¸ì˜ ë Œë”ë§ ë°œìƒ ì‹œ React Fiberì— ì˜í•´ ì—…ë°ì´íŠ¸ ê°ì²´ê°€ íì— ì¶”ê°€ë˜ì–´ ìŠ¤ì¼€ì¤„ë§ì´ ì´ë£¨ì–´ì§€ê²Œ ëœë‹¤. ì´ ê³¼ì •ì—ì„œ ì°¸ì¡° ë™ë“±ì„±(`Object.is()`) ê¸°ë°˜ì˜ ìµœì í™”ê°€ ì´ë£¨ì–´ì§€ëŠ”ë°, í˜„ì¬ì˜ ìƒíƒœì™€ ê°€ì¥ ìµœê·¼ì— ë Œë”ë§ëì—ˆë˜ ìƒíƒœë¥¼ ì—…ë°ì´íŠ¸ íì—ì„œ ê°€ì ¸ì™€ ë™ì¼í•œ ì°¸ì¡°ë¥¼ ê°–ëŠ”ë‹¤ë©´, ë¦¬ì•¡íŠ¸ëŠ” í•´ë‹¹ Stateê°€ ë³€ê²½ëœ ë¶€ë¶„ì´ ì—†ë‹¤ê³  íŒë‹¨í•˜ê³  Early Returnì„ ìˆ˜í–‰í•´ë²„ë¦°ë‹¤.

Setter í•¨ìˆ˜ê°€ í˜¸ì¶œë  ê²½ìš° ê¸°ì¡´ê³¼ ë‹¤ë¥¸ ì°¸ì¡°ë¥¼ ê°–ëŠ” ìƒˆë¡œìš´ ê°ì²´ê°€ ë§Œë“¤ì–´ì§€ì§€ë§Œ, ì§ì ‘ì ìœ¼ë¡œ ê°’ì„ ë³€ê²½í•˜ê²Œ ë˜ë©´ ì´ë“¤ì€ ë™ì¼í•œ ì°¸ì¡°ë¥¼ ê°–ëŠ”ë‹¤. ë”°ë¼ì„œ ë Œë” ìŠ¤ì¼€ì¤„ë§ì—ì„œ ì œì™¸ë˜ê³ , í™”ë©´ì´ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠëŠ” ê²ƒì´ë‹¤.

ì´ëŠ” ë¦¬ì•¡íŠ¸ì—ì„œ ê°•ì¡°í•˜ê³  ìˆëŠ” **ì¸ìˆ˜ì™€ ë°˜í™˜ê°’ì˜ ë¶ˆë³€ì„± ìœ ì§€**ë¥¼ ê¹¨ëœ¨ë¦¬ëŠ” í–‰ìœ„ì´ë©´ì„œ í•µì‹¬ ìµœì í™” ë©”ì»¤ë‹ˆì¦˜ì„ ì™„ì „íˆ ë¬´ë ¥ì‹œí‚¤ê²Œ ë˜ëŠ” í–‰ìœ„ì´ê¸° ë•Œë¬¸ì— ì§€ì–‘í•´ì•¼ í•œë‹¤ëŠ” ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆë‹¤.

<br />

```tsx
react/packages/react-reconciler/src/ReactFiberHooks.js

function mountState<S>(
  initialState: (() => S) | S,
): [S, Dispatch<BasicStateAction<S>>] {
  const hook = mountStateImpl(initialState);
  const queue = hook.queue;
  const dispatch: Dispatch<BasicStateAction<S>> = (dispatchSetState.bind(
    null,
    currentlyRenderingFiber,
    queue,
  ): any);
  queue.dispatch = dispatch;
  return [hook.memoizedState, dispatch];
}

function updateState<S>(
  initialState: (() => S) | S,
): [S, Dispatch<BasicStateAction<S>>] {
  return updateReducer(basicStateReducer, initialState);
}

function rerenderState<S>(
  initialState: (() => S) | S,
): [S, Dispatch<BasicStateAction<S>>] {
  return rerenderReducer(basicStateReducer, initialState);
}
```

ì¬ë°ŒëŠ” ì ì€ **ìµœì´ˆ ë§ˆìš´íŠ¸ëƒ, ë¦¬ë Œë”ë§ì´ëƒì— ë”°ë¼ í•¨ìˆ˜ë¥¼ ë‹¤ë¥´ê²Œ í˜¸ì¶œí•˜ì—¬ ì²˜ë¦¬**í•˜ê³  ìˆë‹¤ëŠ” ê²ƒì´ë‹¤.Current Fiber ë˜ëŠ” Fiberì˜ memoizedStateê°€ ì¡´ì¬í•˜ëŠ” ê²½ìš° UpdateDispatcherë¥¼, ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ê²½ìš° MountDispatcherë¥¼ ë¶„ê¸°í•˜ì—¬ í˜¸ì¶œí•˜ê³  ìˆë‹¤. ë‚´ë¶€ êµ¬í˜„ì´ useReducerë¡œ êµ¬í˜„ë˜ì–´ ìˆëŠ” ë¶€ë¶„ë„ í¥ë¯¸ë¡œìš´ ê²ƒ ê°™ë‹¤.

<br />

### ğŸ“š Case Study

![react_rules_case_study](./images/react_rules_case_study.png)

(ì‘ì„± ì¤‘..)

---

**(TODO)Â ë”¥ë‹¤ì´ë¸Œ : Reactì˜ ë Œë”ë§ ìµœì í™”ì™€ Fiber Architecture**

1. Reactì˜ ë Œë”ë§ ê³¼ì •ì€ ì–´ë–»ê²Œ ì´ë£¨ì–´ì§€ê¸¸ë˜ ì´ëŸ° ê·œì¹™ë“¤ì„ ì¤€ìˆ˜í•´ì•¼ í•˜ëŠ”ê°€?
2. Reactì˜ ìë™ ë Œë”ë§ ìµœì í™”?
3. React ë™ì‹œì„± ê¸°ëŠ¥(Concurrent Features)ê³¼ ì‹œë¶„í•  ë Œë”ë§(Time Slicing)
4. React Fiber, Diffing Algorithm
